<audio id="audio_remote" autoplay="autoplay"></audio>
<audio id="ringtone" src="https://172.20.10.39/sounds/beep.wav"> </audio>
<audio id="ringbacktone" loop src="https://172.20.10.39/sounds/ringbacktone.wav"> </audio>
<audio id="dtmfTone" src="https://172.20.10.39/sounds/dtmf.wav"> </audio>

<script src="{{url('/src/adapter.js')}}"></script>
<script src="{{url('/src/sipml5.js')}}"></script>
<script src="{{url('/src/SIPml.js')}}"></script>

<script src="{{url('/src/tinyMEDIA/src/tmedia_api.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_common.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_defaults.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_param.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_qos.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_session_ghost.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_session.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_session_jsep.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_session_roap.js')}}"></script>
<script src="{{url('/src/tinyMEDIA/src/tmedia_webrtc4all.js')}}"></script>

<script src="{{url('/src/tinySAK/src/tsk_api.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_base64.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_buff.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_fsm.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_md5.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_param.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_ragel.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_string.js')}}"></script>
<script src="{{url('/src/tinySAK/src/tsk_utils.js')}}"></script>

<script src="{{url('/src/tinySDP/src/tsdp_api.js')}}"></script>
<script src="{{url('/src/tinySDP/src/tsdp_message.js')}}"></script>
<script src="{{url('/src/tinySDP/src/tsdp_parser_message.js')}}"></script>

<script src="{{url('/src/tinySDP/src/headers/tsdp_header.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_A.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_C.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_M.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_O.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_Str.js')}}"></script>
<script src="{{url('/src/tinySDP/src/headers/tsdp_header_V.js')}}"></script>

<script src="{{url('/src/tinySIP/src/tsip_api.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_message.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_stack.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_uri.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_action.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_event.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_session.js')}}"></script>
<script src="{{url('/src/tinySIP/src/tsip_timers.js')}}"></script>

<script src="{{url('/src/tinySIP/src/api/tsip_api_common.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_invite.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_options.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_register.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_info.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_message.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_publish.js')}}"></script>
<script src="{{url('/src/tinySIP/src/api/tsip_api_subscribe.js')}}"></script>

<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_generic.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_generic__subscribe.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite__hold.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite__timers.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_register.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_generic__message.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite__client.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_generic__publish.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite__ect.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_invite__server.js')}}"></script>
<script src="{{url('/src/tinySIP/src/dialogs/tsip_dialog_layer.js')}}"></script>

<script src="{{url('/src/tinySIP/src/parsers/tsip_parser_message.js')}}"></script>
<script src="{{url('/src/tinySIP/src/parsers/tsip_parser_header.js')}}"></script>
<script src="{{url('/src/tinySIP/src/parsers/tsip_parser_uri.js')}}"></script>

<script src="{{url('/src/tinySIP/src/transports/tsip_transport.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transports/tsip_transport_layer.js')}}"></script>

<script src="{{url('/src/tinySIP/src/authentication/tsip_auth.js')}}"></script>
<script src="{{url('/src/tinySIP/src/authentication/tsip_challenge.js')}}"></script>

<script src="{{url('/src/tinySIP/src/headers/tsip_header.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Authorization.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_NameAddr.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Contact.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Subscription_State.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Content_Type.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_CSeq.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_WWW_Authenticate.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Int.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_NameAddrArray.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_RAck.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Refer_Sub.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Session_Expires.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_StrArray.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Str.js')}}"></script>
<script src="{{url('/src/tinySIP/src/headers/tsip_header_Via.js')}}"></script>

<script src="{{url('/src/tinySIP/src/transactions/tsip_transac.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transactions/tsip_transac_ict.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transactions/tsip_transac_ist.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transactions/tsip_transac_layer.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transactions/tsip_transac_nict.js')}}"></script>
<script src="{{url('/src/tinySIP/src/transactions/tsip_transac_nist.js')}}"></script>

<script src="https://172.20.10.39/library/jquery.min.js"></script>


<script src="{{url('src/softphone.js')}}"></script>
	<script>
		$(function(){
			var update = true;
			window.setInterval(function(){ 
				if(update){
				update = false;	
				///// ajax para pegar info de chamadas
				$.post('https://172.20.10.39/softphone/getinfo',{},function(val){
					val = JSON.parse(val);
					costumer = val.customer;
					state = val.state
					pause_time = val.pause_time;
					try{
					if(state.length == 0){
							$('#state').attr("data-state","login");
                                                        $('#state').css("background","blue");
                                                        $('#state').css("color","white");
                                                        $('#state').html("Logar na Fila"); 
                                                        $('#pause_field').hide();
					} else {
						if(state[0].paused == 1){ ///// em pausa
							//$('#pause_time').window('open');
							$('#time').html(pause_time[0].time); 
							$('#state').attr("data-state","pause");
                                        		$('#state').css("background","red");
                                        		$('#state').css("color","white");
                                        		$('#state').html("Despausar"); 
	                                        	$('#pause_field').hide();
						} else {
							$('#state').attr("data-state","iddle");
                                        		$('#state').css("background","none");
                                        		$('#state').css("color","black");
                                        		$('#state').html("Pausar");
                                        		$('#pause_field').show();	
						}	
					}
					} catch(err){
					}
				update = true;
	
				});
				
				}	
			},3000);
        });
        
		$('#state').on('click',function(){
			var state = $(this).attr("data-state");
			if(state == "pause"){
				$.post('https://172.20.10.39/softphone/unpause',{},function(val){
					console.log(val);
					//$('#pause_time').window('close');
					$('#state').attr("data-state","iddle");
                                	$('#state').css("background","none");
                                	$('#state').css("color","black");
                                	$('#state').html("Pausar");
					$('#pause_field').show();
					$('#time').html('');
				});
			} 
			if(state == "iddle"){	
				$.post('https://172.20.10.39/softphone/pause',{pause_id: $('select[name=pause_id]').val()},function(val){
					//$('#pause_time').window('open');
					$('#state').attr("data-state","pause");
                                	$('#state').css("background","red");
                                	$('#state').css("color","white");
                                	$('#state').html("Despausar"); 
					$('#pause_field').hide();
				});
			}
			if(state == "login"){
				$.post('https://172.20.10.39/softphone/relogin',{},function(val){});
			}
		});
		$('#config').on('click',function(){
				$('#config_win').window('open');				
		});
		$('#save_config').on('click',function(){
			data = {};
			data.exten = $('input[name=exten]').val();	
			data.exten_password = $('input[name=exten_password]').val();
			$.post('https://172.20.10.39/softphone/saveConfig',data,function(val){
				$('#config_win').window('close');
				config = JSON.parse(val);
				Softphone.exten = config.exten;
				Softphone.exten_password = config.exten_password;	
				Softphone.init();
			});	
		});
		function callTrigger(){
			 //$('#pause_time').window('close');
			 $('#state').trigger('click');	
		}
	</script> 